{% if student %}
<!-- Update fields using OOB swap -->
<input type="number" step="0.01" id="monthly_fee" name="monthly_fee" placeholder="0.00"
    value="{{ student.monthly_fee }}" readonly hx-swap-oob="true">

<input type="hidden" id="student_id" name="student_id" value="{{ student.id }}" hx-swap-oob="true">

{% with calc_amount=remaining_fee|default:student.monthly_fee %}
<input type="number" step="0.01" id="amount" name="amount" required placeholder="0.00" value="{{ calc_amount }}"
    hx-swap-oob="true">
{% endwith %}

<input type="text" id="month_display" name="month_display" readonly placeholder="Auto-filled"
    style="background: var(--card-bg); color: var(--text-dim); cursor: not-allowed;"
    value="{% if next_month == 1 %}January{% elif next_month == 2 %}February{% elif next_month == 3 %}March{% elif next_month == 4 %}April{% elif next_month == 5 %}May{% elif next_month == 6 %}June{% elif next_month == 7 %}July{% elif next_month == 8 %}August{% elif next_month == 9 %}September{% elif next_month == 10 %}October{% elif next_month == 11 %}November{% elif next_month == 12 %}December{% endif %}"
    hx-swap-oob="true">
<input type="hidden" id="month" name="month" value="{{ next_month }}" hx-swap-oob="true">

<input type="text" id="year_display" name="year_display" readonly placeholder="Auto-filled"
    style="background: var(--card-bg); color: var(--text-dim); cursor: not-allowed;" value="{{ next_year }}"
    hx-swap-oob="true">
<input type="hidden" id="year" name="year" value="{{ next_year }}" hx-swap-oob="true">

<div id="fee-message" hx-swap-oob="true">
    {% if remaining_fee > 0 %}
    <div style="color: #f59e0b; font-size: 0.85rem; margin-top: 0.5rem; font-weight: 500;" class="remaining-fee-msg">
        Remaining fee for this month: Rs.{{ remaining_fee }}
    </div>
    {% endif %}
</div>

<!-- Output something in the main target to confirm finding -->
<div style="font-size: 0.8rem; color: var(--secondary); margin-top: 0.5rem;">
    Found: {{ student.name }} ({{ next_month }}/{{ next_year }})
</div>

{% else %}
<!-- Clear fields if no student found -->
<input type="hidden" id="student_id" name="student_id" value="" hx-swap-oob="true">
<input type="number" step="0.01" id="monthly_fee" name="monthly_fee" placeholder="0.00" value="" readonly
    hx-swap-oob="true">
<input type="number" step="0.01" id="amount" name="amount" required placeholder="0.00" value="" hx-swap-oob="true">
<input type="text" id="month_display" name="month_display" readonly placeholder="Auto-filled" value=""
    style="background: var(--card-bg); color: var(--text-dim); cursor: not-allowed;" hx-swap-oob="true">
<input type="text" id="year_display" name="year_display" readonly placeholder="Auto-filled" value=""
    style="background: var(--card-bg); color: var(--text-dim); cursor: not-allowed;" hx-swap-oob="true">
<div id="fee-message" hx-swap-oob="true"></div>
<div style="color: var(--error); font-size: 0.8rem; margin-top: 0.5rem;">Student not found</div>
{% endif %}